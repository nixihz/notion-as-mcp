# CLAUDE.md

This file provides guidance for Claude Code when working with this codebase.

<!--
  TECHNOLOGY CONTEXT - Auto-generated by /speckit.plan
  Last updated: 2025-12-25
  Feature: 001-notion-mcp-tools
-->

## Project Overview

Notion-as-MCP is an MCP (Model Context Protocol) server that uses Notion databases as data sources, distinguishing three MCP primitives (prompt/resource/tool) through type fields.

## Technology Stack

- **Language**: Go 1.25
- **MCP SDK**: github.com/modelcontextprotocol/go-sdk
- **CLI**: github.com/spf13/cobra
- **Config**: github.com/joho/godotenv (env files)
- **Logging**: log/slog (Go 1.21+ standard library)
- **Transport**: stdio (no web interface)

## Project Structure

```
notion-mcp/
├── cmd/
│   ├── root.go          # Cobra root command
│   └── serve.go         # serve subcommand
├── internal/
│   ├── server/          # MCP server implementation
│   ├── cache/           # Memory + file cache
│   ├── notion/          # Notion API client
│   ├── tools/           # Tool execution
│   └── config/          # Configuration
├── tests/
├── .env.example
└── main.go
```

## Key Design Decisions

1. **Two-layer caching**: Memory cache (5 minutes TTL) + file cache (1 hour TTL)
2. **Code execution**: Supports bash/python/js, requires allowlist configuration
3. **Rate limiting**: Exponential backoff retry, Notion API limits to 3 requests per second
4. **Type field**: Defaults to "Type" property, configurable

## Configuration

| Variable | Description |
|----------|-------------|
| `NOTION_API_KEY` | Notion Integration Token (required) |
| `NOTION_DATABASE_ID` | Database ID (required) |
| `NOTION_TYPE_FIELD` | Type property name (默认: Type) |
| `CACHE_TTL` | Cache TTL (默认: 5m) |
| `LOG_LEVEL` | debug/info/warn/error |

## Commands

```bash
# Development run
go run main.go serve

# Build
go build -o notion-mcp main.go

# Test
go test ./...
```

## MCP Protocol

The server implements MCP protocol through stdio:

- `prompts/list` - List prompts
- `prompts/get` - Get prompt content
- `resources/list` - List resources
- `resources/read` - Read resource
- `tools/list` - List tools
- `tools/call` - Call tool

## Notion Data Model

- **Database**: Notion database containing type fields
- **Page**: Entry, properties contain type information
- **Block**: Content block, code block type used for tools
- **Code Block**: `type: code`, contains language and code content

## Code Execution Security

- Execute only single code blocks
- Timeout limit (default 30s)
- No file I/O restrictions
- Configurable allowed language list

---

<!--
  END TECHNOLOGY CONTEXT
-->
