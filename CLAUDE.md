# CLAUDE.md

This file provides guidance for Claude Code when working with this codebase.

<!--
  TECHNOLOGY CONTEXT - Auto-generated by /speckit.plan
  Last updated: 2025-12-25
  Feature: 001-notion-mcp-tools
-->

## Project Overview

Notion-as-MCP 是一个 MCP (Model Context Protocol) 服务器，将 Notion 数据库作为数据源，通过类型字段区分 prompt/resource/tool 三种 MCP 原语。

## Technology Stack

- **Language**: Go 1.25
- **MCP SDK**: github.com/modelcontextprotocol/go-sdk
- **CLI**: github.com/spf13/cobra
- **Config**: github.com/joho/godotenv (env files)
- **Logging**: log/slog (Go 1.21+ standard library)
- **Transport**: stdio (无 Web 界面)

## Project Structure

```
notion-mcp/
├── cmd/
│   ├── root.go          # Cobra root command
│   └── serve.go         # serve subcommand
├── internal/
│   ├── server/          # MCP server implementation
│   ├── cache/           # Memory + file cache
│   ├── notion/          # Notion API client
│   ├── tools/           # Tool execution
│   └── config/          # Configuration
├── tests/
├── .env.example
└── main.go
```

## Key Design Decisions

1. **双层缓存**: 内存缓存（5分钟 TTL）+ 文件缓存（1小时 TTL）
2. **代码执行**: 支持 bash/python/js，需配置允许列表
3. **速率限制**: 指数退避重试，Notion API 限制每秒 3 请求
4. **类型字段**: 默认使用 "Type" 属性，可配置

## Configuration

| Variable | Description |
|----------|-------------|
| `NOTION_API_KEY` | Notion Integration Token (必需) |
| `NOTION_DATABASE_ID` | Database ID (必需) |
| `NOTION_TYPE_FIELD` | Type property name (默认: Type) |
| `CACHE_TTL` | Cache TTL (默认: 5m) |
| `LOG_LEVEL` | debug/info/warn/error |

## Commands

```bash
# 开发运行
go run main.go serve

# 构建
go build -o notion-mcp main.go

# 测试
go test ./...
```

## MCP Protocol

服务器通过 stdio 实现 MCP 协议：

- `prompts/list` - 列出 prompt
- `prompts/get` - 获取 prompt 内容
- `resources/list` - 列出 resource
- `resources/read` - 读取 resource
- `tools/list` - 列出 tool
- `tools/call` - 调用 tool

## Notion Data Model

- **Database**: 包含类型字段的 Notion 数据库
- **Page**: 条目，properties 包含类型信息
- **Block**: 内容块，代码块类型用于 tool
- **Code Block**: `type: code`，包含 language 和代码内容

## Code Execution Security

- 仅执行单个代码块
- 超时限制（默认 30s）
- 无文件 I/O 限制
- 可配置允许的语言列表

---

<!--
  END TECHNOLOGY CONTEXT
-->
