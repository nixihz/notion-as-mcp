<!--
  Sync Impact Report
  ==================
  Version change: N/A → 1.0.0 (Initial creation)
  Modified principles: N/A (new document)
  Added sections:
    - 5 Core Principles (Code Quality, Testing Standards, UX Consistency, Maintainability, Documentation)
    - Quality Standards section (Code Style, Performance, Security)
    - Development Workflow section (Code Review, Commit Practices, Branching)
  Removed sections: N/A
  Templates requiring updates:
    - .specify/templates/plan-template.md (Constitution Check section - generic, no changes needed)
    - .specify/templates/spec-template.md (User Stories & Testing, Success Criteria - already aligned)
    - .specify/templates/tasks-template.md (Test task structure - already aligned)
  Commands templates: .specify/templates/commands/ (directory not created - no updates needed)
  Follow-up TODOs: None
-->

# Notion-as-MCP 项目章程

## 核心原则

### I. 代码质量

所有代码必须符合以下质量标准：

- **清洁代码**：函数必须短小且专注于单一职责。变量名称必须清晰表达其用途。代码必须自文档化或配有必要的注释说明。
- **类型安全**：TypeScript/JavaScript 项目必须使用严格类型检查。Python 项目必须在所有公共 API 上使用类型提示。
- **错误处理**：所有错误路径必须显式处理。错误信息必须提供有意义的调试上下文。
- **禁止调试代码**：console.log、print 语句和调试辅助代码必须在提交前移除。仅使用结构化日志。
- **单一职责**：每个模块、类和函数必须有且只有一个变更理由。避免上帝对象和上帝函数。

**核心理由**：高质量代码减少维护负担，防止 bug，并支持有信心的重构。

### II. 测试标准

所有功能必须按照以下标准进行测试：

- **单元测试**：每个纯函数和工具函数必须有单元测试。业务逻辑代码覆盖率必须超过 80%。
- **契约测试**：服务或模块之间的 API 边界必须有契约测试以验证接口稳定性。
- **集成测试**：跨越多个组件的用户旅程必须有集成测试，覆盖主要流程和关键错误场景。
- **测试独立性**：每个测试必须独立运行，不能依赖其他测试或执行顺序。
- **测试数据**：测试必须使用可重新生成的合成数据。禁止在测试中使用生产数据。
- **确定性测试**：测试必须产生一致的结果。禁止依赖时序、随机性或外部状态的不稳定测试。

**核心理由**：全面的测试支持安全重构，及早捕获回归问题，并记录预期行为。

### III. 用户体验一致性

所有面向用户的行为必须保持一致性：

- **统一的交互模型**：类似操作在所有功能中必须表现一致。如果 Ctrl+Z 在某处能撤销操作，那么类似操作在其他地方也必须能撤销。
- **可预测的反馈**：用户操作必须产生即时、清晰的反馈。加载状态、成功确认和错误提示必须遵循一致的规范。
- **错误信息**：错误信息必须对用户友好、可操作，并且在语气和格式上保持一致。
- **键盘快捷键**：标准快捷键（复制、粘贴、撤销、全选）必须按预期工作。自定义快捷键必须有文档说明，并与项目的交互模型保持一致。
- **视觉一致性**：UI 组件必须在样式、间距、颜色和排版上保持一致。

**核心理由**：一致的 UX 减少认知负担，防止用户错误，并创造专业的体验。

### IV. 可维护性

代码必须为未来的写维护者而：

- **模块化**：功能必须实现为独立、可替换的模块。依赖关系必须明确且最小化。
- **配置优先于硬编码**：行为变化必须使用配置而非代码修改。环境特定的值必须可配置。
- **废弃策略**：移除功能时，必须在移除前提供废弃警告和迁移路径。
- **依赖管理**：依赖必须固定到特定版本。安全补丁必须及时应用。避免使用无人维护的依赖。
- **技术债务追踪**：已知问题或快捷方案必须有文档记录，并附有解决计划。

**核心理由**：软件的维护周期远超开发周期。今天的快捷方式会成为明天的障碍。

### V. 文档

所有非平凡功能必须有文档：

- **API 文档**：公共函数、类和模块必须有 docstring，说明用途、参数、返回值和示例。
- **README**：每个包必须有 README，说明用途、安装方式和基本用法。
- **架构决策**：非显而易见的设计决策必须有文档记录，包含背景和理由（ADR 或代码注释）。
- **用户文档**：面向用户的功能必须有清晰的使用文档。
- **注释解释原因，而非内容**：注释必须解释理由和背景，而非重复代码内容。

**核心理由**：文档加速新成员融入，保留组织知识，并防止误用。

## 质量标准

### 代码风格与静态检查

- 所有项目必须使用带共享配置的 linter（JS/TS 用 ESLint，Python 用 pylint/ruff）。
- 代码必须使用自动格式化工具格式化（JS/TS 用 Prettier，Python 用 ruff/black）。
- 提交前钩子必须在提交前强制执行 linting 和格式化。
- 配置文件必须提交到仓库以确保一致性。

### 性能要求

- API 响应必须在可接受的时间范围内完成（通常 p95 < 200ms）。
- 内存使用必须被监控，不能无限增长。
- 数据库查询必须正确使用索引。禁止 N+1 查询。
- 大数据操作必须使用流式处理或分页，而非一次性加载到内存。

### 安全标准

- 密钥绝不能提交到版本控制。使用环境变量或密钥管理方案。
- 所有用户输入必须经过验证和清理。
- 受保护资源必须实现认证和授权。
- 依赖必须定期进行已知漏洞审计。

## 开发工作流程

### 代码审查要求

- 所有代码在合并前必须经过审查。自我审查不充分。
- 审查者必须验证测试覆盖率、文档和与这些原则的一致性。
- 审查反馈必须被处理或解释。nits（次要建议）可以保留不处理。
- 大型变更（> 400 行）应该拆分为更小的可审查部分。

### 提交规范

- 提交必须是原子的，每个提交包含一个逻辑变更。
- 提交信息必须描述原因，而非仅仅描述做了什么。使用约定式提交格式。
- 工作进行中的提交在合并前必须被压缩。

### 分支与合并

- 功能分支必须从 main/master 为每个独立功能创建。
- 功能分支必须通过 rebase（首选）或 merge commit 保持与 main 同步。
- PR/MR 在合并前必须有通过的 CI。

## 治理

本章程优先于所有其他开发实践。修订遵循以下流程：

1. 提议的变更必须有文档记录，包含理由和影响评估。
2. 变更必须由维护者审查，确保与现有原则一致。
3. 破坏性变更必须有迁移策略和废弃时间表。
4. 修订的版本号遵循语义化版本：
   - MAJOR：原则移除或向后不兼容的重定义
   - MINOR：新原则或重大扩展
   - PATCH：澄清、措辞修复、非语义性改进

对这些原则的遵守在代码审查和持续集成中进行验证。

**Version**: 1.0.0 | **Ratified**: 2025-12-25 | **Last Amended**: 2025-12-25
